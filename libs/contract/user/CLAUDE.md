---
scope: libs/contract/user/
updated: 2025-12-27
relates_to:
  - ../../CLAUDE.md
  - ../../../docs/CONTRACT.md
  - ../../../docs/EFFECT_PATTERNS.md
---

# @samuelho-dev/contract-user

User

## AI Agent Reference

This is a contract library defining domain types and interfaces.
**Entity types are generated by prisma-effect-kysely** from Prisma schemas.

### Structure (Flat lib/ Directory)

- **types.ts**: Type-only exports (zero runtime overhead)
- **lib/generated/**: Entity types from prisma-effect-kysely (run `npx prisma generate`)
  - types.ts: Entity schemas (User, UserSelect, UserInsert, UserUpdate)
  - enums.ts: Enum schemas from Prisma
- **lib/errors.ts**: Domain-specific error types (Data.TaggedError)
- **lib/events.ts**: Domain events (imports entity types from generated/)
- **lib/ports.ts**: Repository/service interfaces (Context.Tag pattern)
- **lib/rpc.ts**: RPC endpoint definitions


### Integration with prisma-effect-kysely

1. **Entity schemas are generated** from Prisma schema, NOT manually created
2. Run `npx prisma generate` to update entity types after schema changes
3. Events and ports import entity types from `./generated` folder

### Customization Guide

1. **Prisma Schema** (source of truth for entities):
   - Define your domain entities in `prisma/schema.prisma`
   - Add custom fields, relations, and validation
   - Run `npx prisma generate` to update types

2. **Errors** (`lib/errors.ts`):
   - Add domain-specific error types
   - Use Data.TaggedError for error handling

3. **Ports** (`lib/ports.ts`):
   - Define repository interfaces
   - Add service interfaces
   - Use Context.Tag for dependency injection

### Usage Example

```typescript
import { User, UserRepository } from '@samuelho-dev/contract-user';
import type { UserInsert } from '@samuelho-dev/contract-user'// Use in your Effect program
Effect.gen(function*() {
  const repo = yield* UserRepository  // Query existing entity
  const entity = yield* repo.findById("id-123")

  // Create new entity (uses prisma-effect-kysely generated Insert type)
  const newEntity = yield* repo.create({
    // ... fields from UserInsert
  })
})
```

## For Future Claude Code Instances

- [ ] Entity types are GENERATED by prisma-effect-kysely
- [ ] Run `npx prisma generate` after schema changes
- [ ] Use Data.TaggedError for domain errors
- [ ] Use Context.Tag for repository interfaces (ports)
- [ ] Events import entity types from `./generated` folder
